# 第一章学习笔记

多数浏览器使用单一进程来处理用户界面（UI）刷新和JavaScript脚本执行，所以同一时刻只能做一件事。`JavaScript`执行过程耗时越久，浏览器等待响应的时间就会越长。

无论当前Javascript代码是内嵌的还是包含在外链文件中，页面的下载和渲染都必须停下来等待脚本执行完成。

## 脚本的位置

> HTML4规范指出，sctipt标签可以放在html文档的head和body中，并允许出现多次。
>
> 按照惯例，script标签用来加载出现在head中的外链JavaScript文件，挨着的link标签用来加载外css文件或者其他页面元信息。

```javascript
<!DOCTYPE html>
<html lang="en">
<head>
    <title>e02-脚本放在head中</title>
    <script type="text/javascript" src="file1.js"></script>
    <script type="text/javascript" src="file2.js"></script>
    <script type="text/javascript" src="file1.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <p>hello world!</p>
</body>
</html>
<!-- 
    这些看似正常的代码实际有着十分严重的性能问题:在head中加载了三个Javascript文件。
    由于脚本会阻塞页面渲染，直到他们完全下载完成后，页面的渲染才会继续。因此页面的性能问题会十分明显。
    在这些文件下载过程中国，用户看到的是一片空白。
    尽管部分浏览器允许并行下载JavaScript文件，这虽然是个好消息，遗憾的是JavaScript的下载依然会阻塞其他资源如图片的下载。
    脚本阻塞依然是个问题。
    由于脚本会阻塞页面其他资源的下载，因此推荐所有的<script>标签尽可能放到<body>标签的底部，以减少对整个页面下载的影响。
 -->
```

**推荐：**`将脚本放在body标签底部`

## 组织脚本

由于每个script标签初始下载都会阻塞页面渲染，所以减少页面包含的script标签数量有助于改善这一情况。

> 这不仅仅是针对外链脚本，内嵌脚本的数量同样也要限制。	

浏览器在解析HTML页面的过程中每遇到一个script标签，都会因执行脚本导致一定的时延，因此最小化延迟时间将会明显改善页面的总体性能。

由于把一段内嵌脚本放在引用外链样式表的link标签后会导致页面阻塞去等待样式表的下载，这样做是为了确保内嵌脚本在执行时获得最精确的样式信息。

>建议：永远不要把内嵌脚本紧跟在link标签后。

考虑到HTTP请求会带来额外的性能开销，因此下载单个100kb的文件比下载4个25KB的文件快。也就是说，减少页面中外链脚本数量将会改善性能。

`通常一个大型网站或者网站应用需要数个JavaScript文件，你可以把多个文件合并成一个文件，这样只需要引用一个script标签，就可以减少性能消耗。`

> 文件合并可通过离线的打包工具实现。 如：Yahoo! combo handler的实时在线服务。

```javascript
<!DOCTYPE html>
<html lang="en">
<head>
    <title>e04 组织脚本</title>
</head>
<body>
    <p>Hello World!</p>
    <!-- 推荐的脚本存放位置 -->
    <script type="text/javascript" src="
    http://yui.yahooapis.combo?2.7.0/build/yahoo/yahoo-min.js&
    2.7.0/build/event/event-min.js
    "></script>
</body>
</html>

<!-- 这段代码只有一个位于页面底部的script标签，它却加载了多个Javascript文件。 -->
```

